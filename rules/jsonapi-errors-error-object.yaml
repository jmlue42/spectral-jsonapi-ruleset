# Errors - Error Object
# https://jsonapi.org/format/#errors

# all rules in this file MUST have corresponding tests

rules:
  error-object-type:
    description: "Error objects MUST be returned as an array keyed by errors in the top level of a JSON:API document."
    documentationUrl: https://jsonapi.org/format/#error-objects
    message: "{{path}} - {{description}}"
    severity: error
    given: $.paths..content[application/vnd.api+json'].schema.properties[errors]
    then:
      field: "type"
      function: enumeration
      functionOptions:
        values:
          - array
  
  error-object-properties:
    description: "Must follow error object properties."
      documentationUrl: https://jsonapi.org/format/#error-objects
      message: "{{path}} - {{description}}"
      severity: error
      given: $.paths..content[application/vnd.api+json].schema.properties[errors]..allOf.*.properties
      then:
        field: '@key'
        function: enumeration
        functionOptions:
          values:
            - id
            - links
            - status
            - code
            - title
            - detail
            - source
            - meta