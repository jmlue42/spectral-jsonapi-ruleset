# Document Structure - Links
# https://jsonapi.org/format/#document-links

# all rules in this file MUST have corresponding tests

rules:
  links-object:
    description: "The value of each links member MUST be an object (a “links object”)"
    documentationUrl: https://jsonapi.org/format/#document-meta
    message: "{{path}} - {{description}}"
    severity: error
    given: $..properties[?(@property === 'links')]
    then:
      field: "type"
      function: enumeration
      functionOptions:
        values:
          - object
  links-object-schema-type:
    description: "A link must be represented as either a string containing the link's URL or an object"
    documentationUrl: https://jsonapi.org/format/#document-links
    message: "{{path}} - {{description}}"
    severity: error
    given: $..properties[?(@property === 'links')].properties.'*'
    then:
      field: "type"
      function: enumeration
      functionOptions:
        values:
          - object
          - string
  links-object-schema-properties:
    description: "An object (“link object”) which can contain the following members (href and meta)"
    documentationUrl: https://jsonapi.org/format/#document-links
    message: "{{path}} - {{description}}"
    severity: error
    given: $..properties[?(@property === 'links')].properties.'*'.properties
    then:
      field: "@key"
      function: enumeration
      functionOptions:
        values:
          - href
          - meta
  links-object-schema-properties-href:
    description: "Href is a string containing the link's URL"
    documentationUrl: https://jsonapi.org/format/#document-links
    message: "{{path}} - {{description}}"
    severity: error
    given: $..properties[?(@property === 'links')].properties.'*'.properties[?(@property === 'href')]
    then:
      field: "type"
      function: enumeration
      functionOptions:
        values:
          - string
